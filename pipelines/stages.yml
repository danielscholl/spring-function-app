parameters:
  environments: []

stages:

- stage: ci
  displayName: 'Build Image'
  jobs:
  - template: build.yml

- ${{ each environment in parameters.environments }}:
  - stage: ${{ environment.name }}_deploy
    displayName: 'Push Image-${{ environment.name }}'
    jobs:
    - template: deploy.yml
      parameters:
        environment: ${{ environment.name }}
        acr_registry_name: ${{ environment.acrRegistryName }}
        acr_service_connection: ${{ environment.acrServiceConnection }}
